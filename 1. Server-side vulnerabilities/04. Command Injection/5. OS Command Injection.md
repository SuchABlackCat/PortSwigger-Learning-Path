<h1>OS Command Injection</h1>
<h2>1. Khái niệm</h2>
<p>OS command injection (shell injection) là lỗ hổng bảo mật cho phép kẻ tấn công <b><i>chèn (inject) các OS Command trên server</i></b> – nơi ứng dụng đang chạy</p>
<p>Ứng dụng thường gọi các command để xử lý tác vụ (vd: đọc file, lấy dữ liệu từ script). Nếu dữ liệu người dùng cung cấp được chèn thẳng vào dòng lệnh mà không kiểm soát, kẻ tấn công có thể: thêm lệnh mới, thay đổi lệnh, tự chạy các system command (như <code>whoami</code>, <code>cat /etc/passwd</code>).</p>
<p>Điều này có thể dẫn đến chiếm quyền máy chủ, truy cập dữ liệu nội bộ, pivot sang hệ thống khác trong mạng,...</p>
<h2>2. Useful Commands</h2>
<table>
  <thead>
    <tr>
      <th>Mục đích</th>
      <th>Linux</th>
      <th>Windows</th>
      <th>Giải thích</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Xem user hiện tại</td>
      <td><code>whoami</code></td>
      <td><code>whoami</code></td>
      <td>Biết quyền hạn hiện có để leo thang đặc quyền</td>
    </tr>
    <tr>
      <td>Xem hệ điều hành</td>
      <td><code>uname -a</code></td>
      <td><code>ver</code></td>
      <td>Biết loại OS để chọn kỹ thuật tấn công phù hợp</td>
    </tr>
    <tr>
      <td>Cấu hình mạng</td>
      <td><code>ifconfig</code></td>
      <td><code>ipconfig /all</code></td>
      <td>Tìm mạng nội bộ, IP, gateway</td>
    </tr>
    <tr>
      <td>Kết nối mạng</td>
      <td><code>netstat -an</code></td>
      <td><code>netstat -an</code></td>
      <td>Tìm port mở, dịch vụ server kết nối</td>
    </tr>
    <tr>
      <td>Tiến trình đang chạy</td>
      <td><code>ps -ef</code></td>
      <td><code>tasklist</code></td>
      <td>Kiểm tra dịch vụ quan trọng hoặc mục tiêu có thể tấn công</td>
    </tr>
  </tbody>
</table>

<h2>3. Ví dụ mô phỏng</h2>
<p>Ứng dụng có đường dẫn:</p>
<pre>https://insecure-website.com/stockStatus?productID=381&storeID=29</pre>
<p>Chạy lệnh nội bộ: <code>stockreport.pl 381 29</code></p>
<p>Khi đó, attacker gửi payload: <code>& echo aiwefwlguh &</code></p>
<p>Lệnh trở thành: <code>stockreport.pl & echo aiwefwlguh & 29</code></p>
<p>Shell sẽ hiểu thành 3 lệnh riêng:</p>
<ul>
  <li>stockreport.pl → chạy thiếu argument → lỗi</li>
  <li>echo aiwefwlguh → in ra chuỗi thử nghiệm</li>
  <li>29 → cố chạy “29” như lệnh → lỗi</li>
</ul>
<p>Kết quả hiển thị:</p>
<ul>
  <li>Error - productID was not provided</li>
  <li>aiwefwlguh</li>
  <li>29: command not found</li>
</ul>
<p>=> Bạn đã xác nhận được lệnh injected đã chạy thành công (vì chữ aiwefwlguh xuất hiện).</p>
