# Authentication

## 1. Authentication là gì?
**Authentication**: quá trình xác minh danh tính của một user/client.

Thông thường, có ba loại yếu tố authentication chính:
- **Knowledge factors**: *Something you know* (VD: mật khẩu hoặc câu trả lời cho câu hỏi bảo mật).
- **Possession factors**: *Something you have* (VD: thiết bị di động, USB token, thẻ bảo mật).
- **Inherence factors**: 
*Something you are/do* – đặc điểm thuộc về bạn, chẳng hạn vân tay, khuôn mặt, giọng nói hoặc các mẫu hành vi.

### Authentication vs. Authorization

**Authentication** trả lời "*Who are you?*"
<br>-> Xác minh danh tính user (username/password, OTP, biometrics,...).

**Authorization** trả lời "*What are you allowed to do?*"<br>-> Kiểm tra quyền hạn sau khi xác thực user.

## 2. Nguyên nhân & Hậu quả
### Nguyên nhân
- Cơ chế xác thực yếu → dễ bị brute-force
  - Không giới hạn số lần thử password
  - Không có rate-limiting, lockout, CAPTCHA.
  - Mật khẩu yếu, dự đoán được.
  - MFA triển khai sai hoặc không có MFA.
- Broken Authentication: lỗi lập trình/logic khiến không cần đúng password vẫn login được
  - Bỏ qua bước kiểm tra password (path logic sai).
  - Reset password không kiểm tra danh tính thật.
  - Sử dụng token dự đoán được.
  - Sử dụng session ID cố định hoặc dễ đoán.
  - Endpoint xác thực bị lộ, không kiểm tra trạng thái session.
  - Xác thực 2 bước nhưng bước thứ 2 không bắt buộc.


### Hậu quả
1. Attacker truy cập vào tài khoản của nạn nhân
2. Nếu chiếm được tài khoản “quyền cao” → takeover toàn bộ hệ thống
3. Tài khoản low-privilege cũng nguy hiểm

## 3. Vulnerabilities in PASSWORD-BASED LOGIN
### 3.1. Brute-force Attack
Brute-force = thử hàng loạt username/password tự động.

#### 3.1.1. Brute-force username:
- Usernames dễ đoán (`firstname.lastname@domain`) hoặc tên mặc định: `admin`, `administrator`.
- Website lộ username trong profile, email trong response

#### 3.1.2. Brute-forcing passwords

User thường đặt password dễ đoán:
```
mypassword → Mypassword1!
```
hoặc đổi định kỳ:
```
Mypassword1! → Mypassword2!
```

#### 3.1.3. Enumerate Username
Attacker quan sát khác biệt trong response để xác định username có tồn tại hay không:
- **HTTP status codes**
- **Error messages** (chỉ cần sai một dấu cách, dấu chấm cũng đủ)
- **Response time** (website chỉ kiểm tra password nếu username đúng → tốn thời gian hơn)

→ Giảm mạnh số username cần brute-force.

#### 3.1.4. Flawed brute-force protection (Bảo vệ brute-force bị lỗi)
**IP blocking**

VD: Bộ đếm số lần sai reset khi người dùng đăng nhập thành công.<br>=> Attacker chỉ cần chèn credential đúng của chính attacker vào wordlist, ví dụ:
```
victim:wrongpass1
victim:wrongpass2
attacker:correctpass   <-- reset counter
victim:wrongpass3
attacker:correctpass
...
```
→ Không bao giờ vượt ngưỡng → bỏ qua được cơ chế IP block.

**Account locking**

=> Nếu `limit=3`, brute-force diện rộng: attacker thử 3 password cho mỗi username → không bị khóa.

- **Credential stuffing**: dùng username:password bị lộ từ một nơi khác (user có xu hướng đặt cùng mật khẩu cho nhiều nơi).


**User Rate Limiting**

=> **Đổi IP** (proxy, X-Forwarded-For, VPN) hoặc **Ghép nhiều credential vào 1 request duy nhất** (lab multiple credentials per request)

