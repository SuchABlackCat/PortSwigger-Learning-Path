<h1>File Upload Vulnerabilities</h1>

<h2>1. File upload vulnerabilities là gì?</h2>
<p>Lỗ hổng xảy ra khi user được phép và tải những file đáng nghi, độc hại lên server.<br>Khi đó, thậm chí hacker có thể chạy mã (Remote Code Execution – RCE) ngay trên server.</p>


<h2>2. Web Shell</h2>
<p>Web shell là một đoạn mã độc cho phép hacker gửi lệnh đến server thông qua HTTP.</p>
<p>Khi upload thành công web shell được ẩn trong file, hacker có thể:</p>
<ul>
  <li>Đọc/ghi file trên server</li>
  <li>Lấy cắp dữ liệu</li>
  <li>Chạy lệnh hệ điều hành</li>
  <li>Tấn công hệ thống nội bộ thông qua server bị chiếm quyền</li>
</ul>
<p><b>Ví dụ web shell đơn giản (PHP):</b></p>
<pre>&lt;?php echo file_get_contents('/path/to/target/file'); ?&gt;</pre>
<p>Gửi yêu cầu HTTP để truy cập file này, server sẽ trả về nội dung file mà hacker muốn lấy.</p>
<p><b>Web shell mạnh hơn:</b></p>
<pre>&lt;?php echo system($_GET['command']); ?&gt;</pre>
<p>Hacker có thể chạy lệnh:</p>
<pre>GET /exploit.php?command=id</pre>
<p>→ Server sẽ chạy lệnh <code>id</code> và trả về kết quả.</p>


<h2>3. Flawed Validation</h2>
<p>Hầu hết website đều cố gắng chống upload file độc hại, nhưng các biện pháp thường rất yếu.<br>
Ngay cả khi có kiểm tra, hacker vẫn có thể bypass nếu validation sai hoặc sơ hở.</p>

<h3>3.1. Multipart/form-data</h3>
<p>Khi upload file, trình duyệt gửi request kiểu <code>multipart/form-data</code>.<br>
Trong request sẽ có nhiều phần (parts), mỗi phần có header riêng.</p>
<p>Ví dụ upload ảnh + mô tả:</p>
<pre>
POST /images HTTP/1.1
Content-Type: multipart/form-data; boundary=---BOUNDARY

---BOUNDARY
Content-Disposition: form-data; name="image"; filename="example.jpg"
Content-Type: image/jpeg
[binary content]
---BOUNDARY
Content-Disposition: form-data; name="description"
This is my description.
---BOUNDARY
Content-Disposition: form-data; name="username"
wiener
---BOUNDARY--
</pre>

<p>Mỗi phần đều có:</p>
<ul>
  <li><b>Content-Disposition</b>: tên và filename</li>
  <li><b>Content-Type</b>: loại file</li>
</ul>


<h3>3.2. Kiểm tra Content-Type sai</h3>
<p>Một số website chỉ kiểm tra <code>Content-Type</code> của file upload, ví dụ chỉ cho phép:</p>
<ul>
  <li>image/jpeg</li>
  <li>image/png</li>
</ul>

<p>Nhưng đây là sai lầm lớn, vì:</p>
<ul>
  <li>Giá trị <code>Content-Type</code> do trình duyệt (hoặc hacker) tự gửi.</li>
  <li>Server <b><i>không kiểm tra nội dung thực sự</i></b> của file.</li>
</ul>

<p>⇒ Hacker có thể upload file PHP nhưng đặt Content-Type giả thành image/jpeg, và server vẫn cho upload.<br>Việc này rất dễ làm bằng Burp Repeater: chỉ cần sửa header mà không đổi nội dung file.</p>
