# CSRF vulnerability with no defenses (COMMUNITY Edition)
**Má»¥c tiÃªu**: 
- Lab nÃ y yÃªu cáº§u báº¡n táº¡o má»™t trang HTML Ä‘á»™c háº¡i (CSRF exploit).
- Khi náº¡n nhÃ¢n má»Ÿ trang Ä‘Ã³, browser cá»§a há» sáº½ tá»± Ä‘á»™ng gá»­i request POST Ä‘á»ƒ Ä‘á»•i email tÃ i khoáº£n cá»§a há», mÃ  há» khÃ´ng há» biáº¿t.
- VÃ¬ lab khÃ´ng cÃ³ báº¥t ká»³ báº£o vá»‡ CSRF nÃ o, nÃªn báº¡n chá»‰ cáº§n táº¡o Ä‘Ãºng request â†’ sáº½ thÃ nh cÃ´ng.

## 1. Má»Ÿ Burp vÃ  Ä‘Äƒng nháº­p Ä‘á»ƒ láº¥y request

Äá»ƒ táº¡o Ä‘Æ°á»£c CSRF, báº¡n pháº£i biáº¿t chÃ­nh xÃ¡c request tháº­t mÃ  server yÃªu cáº§u khi Ä‘á»•i email, bao gá»“m:
- Ä‘Æ°á»ng dáº«n chÃ­nh xÃ¡c (vÃ­ dá»¥ `/my-account/change-email`)
- request dÃ¹ng POST hay GET
- tham sá»‘ server muá»‘n (`email=...`)
- URL Ä‘áº§y Ä‘á»§ gá»“m subdomain cá»§a lab

Báº¡n cáº§n:
- Má»Ÿ Burp Suite â†’ báº­t Proxy Intercept Off â†’ Má»Ÿ Burp Browser.
- Truy cáº­p lab vá»›i tÃ i khoáº£n: `wiener:peter` 
- VÃ o trang My Account vÃ  Ä‘á»•i email thá»­.

## 2. TÃ¬m request Ä‘á»•i email
- TÃ¬m request kiá»ƒu:
```
POST /my-account/change-email HTTP/2
Host: <lab-id>.web-security-academy.net
```
- Copy `<lab-id>`.
<img width="516" height="185" alt="image" src="https://github.com/user-attachments/assets/a8a8be74-2172-495e-9467-700987754b53" />

## 3. Táº¡o HTML exploit
- Táº¡o má»™t file HTML nhÆ° sau:
```
<html>
  <body>
    <form method="POST" action="https://YOUR-LAB-ID.web-security-academy.net/my-account/change-email">
      <input type="hidden" name="email" value="pwned%40evil.com">
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```
- `<form method="POST" action="https://YOUR-LAB-ID.web-security-academy.net/my-account/change-email">`: VÃ¬ request gá»‘c cÃ³ medthod lÃ  `POST`, vÃ  `action` chá»©a URL nÆ¡i gá»­i request giáº£ Ä‘áº¿n.
- `<input type="hidden" name="email" value="pwned%40evil.com">`: Browswer sáº½ gá»­i `email=...` mÃ  náº¡n nhÃ¢n khÃ´ng tháº¥y vÃ  khÃ´ng cáº§n báº¥m (`input type="hidden"`).
- `document.forms[0].submit();`: Auto-submit.

## 4. Táº£i exploit lÃªn Exploit Server
âœ”ï¸ HÃ nh Ä‘á»™ng:

Má»Ÿ Exploit Server (nÃºt bÃªn pháº£i trang lab).

Äiá»n vÃ o:

Header:

HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8


Body: (dÃ¡n HTML á»Ÿ bÆ°á»›c 3)
3. Click Store.

â“ Táº¡i sao pháº£i Ä‘áº·t Content-Type?

Náº¿u báº¡n khÃ´ng khai bÃ¡o:

Content-Type: text/html


trÃ¬nh duyá»‡t cÃ³ thá»ƒ:

khÃ´ng render HTML

khÃ´ng cháº¡y script

khÃ´ng gá»­i form

â†’ CSRF tháº¥t báº¡i.

5. Kiá»ƒm tra exploit báº±ng â€œView exploitâ€
âœ”ï¸ HÃ nh Ä‘á»™ng:

Nháº¥n View exploit.

Browser (vá»›i cookie cá»§a báº¡n) sáº½ gá»­i request Ä‘á»ƒ Ä‘á»•i email.

Kiá»ƒm tra trong Burp â†’ HTTP history xem cÃ³ request POST tÆ°Æ¡ng tá»± nhÆ°:

POST /my-account/change-email
email=pwned@evil.com

â“ Táº¡i sao pháº£i test trÆ°á»›c?

Náº¿u báº¡n khÃ´ng test mÃ  gá»­i ngay cho victim â†’
náº¿u cÃ³ lá»—i â†’ báº¡n khÃ´ng biáº¿t â†’ lab khÃ´ng solve.

6. Sá»­a email thÃ nh email Ä‘á»™c háº¡i
âœ”ï¸ HÃ nh Ä‘á»™ng:

Trong file HTML, Ä‘á»•i dÃ²ng:

<input type="hidden" name="email" value="victim%40attack.com">


Quan trá»ng: email nÃ y khÃ´ng Ä‘Æ°á»£c trÃ¹ng vá»›i email tÃ i khoáº£n wiener.

â“ Táº¡i sao pháº£i Ä‘á»•i email khÃ¡c?

Lab sáº½ xÃ¡c nháº­n:

Náº¿u email thay Ä‘á»•i thÃ nh email má»›i â†’ Solved

Náº¿u báº¡n dÃ¹ng email hiá»‡n táº¡i â†’ server khÃ´ng Ä‘á»•i gÃ¬ â†’ khÃ´ng solve.

7. Deliver exploit to victim â†’ HoÃ n thÃ nh
âœ”ï¸ HÃ nh Ä‘á»™ng:

Nháº¥n Deliver to victim.

Chá» vÃ i giÃ¢y.

Lab sáº½ bÃ¡o Solved.

ğŸ‰ Káº¿t luáº­n

Báº¡n Ä‘Ã£ thá»±c hiá»‡n thÃ nh cÃ´ng má»™t cuá»™c táº¥n cÃ´ng CSRF dáº¡ng Ä‘Æ¡n giáº£n nháº¥t:
Ã©p trÃ¬nh duyá»‡t ngÆ°á»i dÃ¹ng gá»­i POST request mÃ  khÃ´ng cáº§n tÆ°Æ¡ng tÃ¡c.

ToÃ n bá»™ logic táº¥n cÃ´ng hoáº¡t Ä‘á»™ng vÃ¬:

khÃ´ng cÃ³ CSRF token

khÃ´ng cÃ³ SameSite cookie

khÃ´ng cÃ³ Referer check

server khÃ´ng phÃ¢n biá»‡t request há»£p lá»‡ vÃ  request do attacker táº¡o
