# Path Traversal

## 1. Khái niệm
**Path Traversal** là lỗ hổng cho phép attacker điều khiển đường dẫn file mà ứng dụng sẽ đọc hoặc ghi.  
Nếu ứng dụng ghép đường dẫn từ input của người dùng mà **không kiểm tra**, attacker có thể:

- Đọc file nhạy cảm trên server  
- Lấy mã nguồn ứng dụng  
- Lấy thông tin mật: key, password, token  
- Ghi đè file → chiếm quyền điều khiển server  

=> Mấu chốt: Ký tự `../` dùng để “thoát ra ngoài” thư mục hiện tại.

## 2. Cách hoạt động

Giả sử ứng dụng tải ảnh bằng URL:

```html
<img src="/loadImage?filename=218.png">
```

Code phía sau có dạng:

```
file = /var/www/images/<filename>
```

Khi attacker gửi:

```
filename=../../../etc/passwd
```

Server sẽ đọc:
```
file = /var/www/images/../../../etc/passwd
```
Tương đương `file = /etc/passwd` (vì `../` = “lùi 1 thư mục”.)


## 3. Path Traversal trên Windows
Trên Windows:

`../` hợp lệ

`..\` cũng hợp lệ

Ví dụ: `filename=..\..\..\windows\win.ini`

## 4. Các biện pháp phòng thủ thường thấy và cách bypass
Nhiều ứng dụng cố gắng chặn Path Traversal, nhưng đa phần có thể bị vượt qua bằng các kỹ thuật sau:

**Chặn `../`**

=> Dùng thẳng đường dẫn tuyệt đối `filename=/etc/passwd`

**Strip `../` một lần**

=> Dùng dạng chồng: `....//`, `....\/`

**Xóa `../`**

- URL Encoding: `../` = `%2e%2e%2f`
- Double encode = `%252e%252e%252f`
- Các variant phi chuẩn: `..%c0%af`, `..%ef%bc%8f`

**Yêu cầu kết thúc bằng .png**

Một số ngôn ngữ (C, PHP cũ, thư viện cũ) dừng đọc chuỗi tại ký tự null `\0`. 

=> `../../../etc/passwd%00.png`
